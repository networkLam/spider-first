








<html lang="zh-CN">
<head>
    <meta charset="utf-8">
	<meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta http-equiv="X-Permitted-Cross-Domain-Policies" content="master-only">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>登录</title>
	<meta http-equiv="keywords" content="教务管理 数字校园 综合教务管理 教学管理 中职数字校园 强智科技 高校教务 迎新 学工系统 收费系统 人事管理 科研管理 课程资源 网站群 在线支付管理 一卡通 智慧教室" />
	<meta http-equiv="description" content="湖南强智科技发展有限公司（www.qzdatasoft.com）是中国数字化校园软件专业提供商。十多年来，强智科技一直致力于中国教育信息化平台的研发与推广；强智新一代综合教学管理平台将教、学、管理、服务与决策完美结合的设计理念，众多高校的成功实施，必将成为行业的标杆，永载史册。" />
    <link href="/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/css/reset.css">
    <link rel="stylesheet" type="text/css" href="/css/style.css">
	<script src="/css/crypto-js.min.js"></script>
</head>
<style>
.QRcodeSkip{
	width: 80px;
	height: 70px;
	position: absolute;
	visibility: inherit;
	right: 17.5%;
	cursor: pointer;
}
.QRcode{
	width: 300px;
	height: 300px;
	position: absolute;
	visibility: inherit;
	right: 21%;
	top: 30%;
}
</style>

<body class="login_bg">
	<div id="login_content">
		<div class="login_logo">
			<img class="img-responsive" src="/css/images/login_logo.png" >
		</div>
		<div class="login_box">
			 <div class="box_left">
				 
				 <img class="img-responsive" src="/css/images/login_icon.png" >
				 
			 </div>
			 <!-- 二维码跳转图片 -->
			 <div  class="QRcodeSkip" id="QRcodeSkip" style="display: none;"	>
			 	<img onclick="QRcodeFun(1)" alt="加载失败" height="70" width="80" src="/css/images/showCode.png" >
			 </div>
			 <div class="box_right" style="">
			 	<form id="loginForm" name="loginForm" action="/Logon.do?method=logon" method="post">
			 		<ul id="ul1" >
			 			<li class="box_bt"><img class="img-responsive" src="/css/images/user_icon.png"  style="float:left;margin:8px 8px 0 0">用户登录</li>
			 			<li class="input-group input_li">
							  <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
							  <input type="text" class="form-control" id="userAccount" name="userAccount" placeholder="请输入账号" value="" autofocus>
			 			</li>
			 			<li class="input-group input_li">
							  <span class="input-group-addon" id="basic-addon1"><i class="glyphicon glyphicon-lock"></i></span>
							  <input type="password" class="form-control" id="userPassword" name="userPassword"  autocomplete="off" placeholder="请输入密码" value="">
			 			</li>
			 			
			 			

			 			

			 			<li class="input-group input_li">
							<ul>
			 				  	<li class="no_padding col-sm-9" style="width: 60%;">
			 				  		<input type="text" class="form-control" style="width: 100%" id="RANDOMCODE" name="RANDOMCODE" placeholder="请输入验证码">
			 				  	</li>
			 				  	<li class="no_padding col-sm-3">
			 				  		<img src="/verifycode.servlet" id="SafeCodeImg"  onclick="ReShowCode()" width="80px" height="40px" style="margin-left: 5px;" />
			 				  	</li>
							</ul>
			 			</li>
			 			
			 			
			 			<li class="input-group input_li">
							        <span><a  href="/findmm.jsp" target="_blank" style="font-size:16px">忘记密码</a>
									<span id="text1" style="color: red;font-size: 16px;margin-left: 80px"></span>
										<span id="text2" style="color: red;font-size: 16px;margin-right: 40px"></span></span>
							
			 			</li>
			 			
<!-- 			 			<li class="input-group input_li"> -->
<!-- 							  <input type="checkbox" name="vehicle">记住密码 -->
<!-- 							  <a class="forget">忘记密码</a> -->
<!-- 			 			</li> -->
			 			<li class="input_li">
			 			    
							<button type="button" class="btn btn-primary login_btn" onclick="login()">登&nbsp;&nbsp;&nbsp;录</button>
							
			 			</li>
						
						
						

						<li class="input_li"  style="color: red; margin-bottom: 0;height: 10px;">
							&nbsp;<font color="red">温馨提示：推荐使用IE9以上浏览器以及360极速模式。</font><br>

						</li>
						

						<li class="input_li"  style="color: red; margin-bottom: 0;height: 10px;">
							<font color="red">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
								&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
								推荐在分辨率1920*1080下使用最佳。</font>
						</li>
			 			<li class="input_li" id="showMsg" style="color: red; margin-bottom: 0;">
							&nbsp;
			 			</li>
			 		</ul>
			 		<!-- 二维码展示层 -->
			 		<ul id="ul2" style="display: none;" >
			 			<li class="box_bt">
			 				<p class="u9" >APP下载
			 					<span style="font-size: 13px;cursor: pointer;text-align: right;float: right;" onclick="QRcodeFun(2)" >
				 					<img   alt="加载失败" height="13" width="13" src="/css/images/ret.png" >
				 					返回登录
			 					</span>
			 				</p>
			 			</li>
			 			<li class="input_li" style="text-align: center;"  >
			 				<center><img class="img-responsive" alt="加载失败" height="300" width="300" src="/css/images/codeFrame.png" ></center>
			 			</li>
			 			<li class="input_li" style=" margin-bottom: 0;height: 15.5px;">
							<center>扫描二维码  下载APP</center>
			 			</li>
			 		</ul>
			 		<input name="encoded" id="encoded" type="hidden" value=""/>
			 	</form>
			 </div>
		</div>
	</div>

	<footer>Copyright © 2017.湖南强智科技发展有限公司</footer>

    <script type="text/javascript" src="/js/wechar/uasLogin.js"></script>
    <script src="/framework/commonJs/jquery.min.js"></script>
    <script src="/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/js/jspublic.js"></script>
	<script type="text/javascript" src="/framework/commonJs/jquery.min.js"></script>

  </body>

   
</html>
<script  type="text/javascript">
	//辽宁石油化工大学个性化 增加跳转cas统一认证登录界面
	function Opencaslog() {
		window.location.href="/sso.jsp";
	}

//$("#zhmm").click(function(){
//   JsMod('/findmm.jsp',450,200);
//})
//是否启用APP下载二维码





function ReShowCode(){
	var SafeCodeImg = document.getElementById("SafeCodeImg");
	var url = "/verifycode.servlet?t="+Math.random();
	SafeCodeImg.src = url;
}
function login() {
	if($("#userAccount").val() == "") {
		$("#showMsg").text("请输入账号");
		$("#userAccount").focus();
		return false;
	}
	if($("#userPassword").val() == "") {
		$("#showMsg").text("请输入密码");
		$("#userPassword").focus();
		return false;
	}
	
	if($("#RANDOMCODE").val() == "") {
		$("#showMsg").text("请输入验证码");
		$("#RANDOMCODE").focus();
		return false;
	}
	

		var strUrl = "/Logon.do?method=logon&flag=sess";

	$.ajax( {
		url:strUrl,
  		type:"post",
  		cache:false,
		dataType:"text",
		success:function(dataStr) {
			if(dataStr=="no"){
				return false;
	 		}else{
	 			var scode=dataStr.split("#")[0];
		     	var sxh=dataStr.split("#")[1];
		     	var code=document.getElementById("userAccount").value+"%%%"+document.getElementById("userPassword").value;
			 	var encoded="";
				for(var i=0;i<code.length;i++){
					if(i<20){
						encoded=encoded+code.substring(i,i+1)+scode.substring(0,parseInt(sxh.substring(i,i+1)));
					    scode = scode.substring(parseInt(sxh.substring(i,i+1)),scode.length);
					}else{
					    encoded=encoded+code.substring(i,code.length);
					    i=code.length;
					}
				}
				document.getElementById("encoded").value=encoded;
				if("logon"!="logonLdap"){
					document.getElementById("userPassword").value="";
					document.getElementById("userAccount").value="";
				}
				document.getElementById("loginForm").submit();
	 		}
		},
		error:function() {
	 		alert("计算异常！");
		}
  	});
}
$(function(){
	$(document).on("keyup", function(e){
		if(e.keyCode == 13) {
			login();
		}
	});
});

/***
*切换验证码
**/
function QRcodeFun(type) {
	if("1" == type ){
		$("#ul1").hide();
		$("#ul2").show();
		$("#QRcodeSkip").hide();
	}else{
		$("#ul2").hide();
		$("#ul1").show();
		$("#QRcodeSkip").show();
	}

}

	
  function openWechar(){
       var ul1 = $("#ul1");
       var user = ul1.find("li").eq(1);
       var pwd = ul1.find("li").eq(2);
       user.css("display","none");
       pwd.css("display","none");
       $("#userAccount").val("");
       $("#userPassword").val("");
       var logonBtn = $("button[onclick='login()']");
       logonBtn.css("display","none");
       $("#bjkjdx_qrcode").css("display","");

       //干掉验证码

        
            var yzm = ul1.find("li").eq(4);
            yzm.css("display","none");
        

       //调用第三方js生成二维码
       // bjkjdx_qrcode_view

       $.ajax({
            url:"https://jwgl.ustb.edu.cn/glht/Logon.do?method=randToken",
            type:"POST",
            sync:"false",
            success:function(result){
                var ret = JSON.parse(result);
                var token = ret.rand_token;
                var app = ret.appid;
                display_qrcode(token,app);
            },
            error:function(){
                alert('计算异常');
            }
       });

  }

  function display_qrcode(token,app){
       var objLogin = {
            id:"bjkjdx_qrcode_view",
            api_url:"https://sis.ustb.edu.cn/connect/qrpage",
            appid:app,
            return_url:"https://jwgl.ustb.edu.cn/glht/Logon.do?method=weCharLogin",
            rand_token:token,
            width:"250px",
            height:"200px",
       };
       UasLogin(objLogin);
  }

  function closeWechar(){
       var ul1 = $("#ul1");
       var user = ul1.find("li").eq(1);
       var pwd = ul1.find("li").eq(2);
       user.css("display","");
       pwd.css("display","");
       var logonBtn = $("button[onclick='login()']");
       logonBtn.css("display","");
       $("#bjkjdx_qrcode").css("display","none");
        
            var yzm = ul1.find("li").eq(4);
            yzm.css("display","");
        
  }

    var isCapital = -1;
    jQuery(window).keyup(changeCapsLock);
    jQuery('input[name=userPassword]').on('keyup', function(e){
        if (e.keyCode==13){
            login();
        }
        var lastVal = '';
        lastVal = jQuery(this).val().substr(getCursortPosition.call(this,this)-1, 1).charCodeAt(0);
        var a2=String.fromCharCode(lastVal).toUpperCase().charCodeAt();//输入的字母大写对应的ascll值
        if (e.keyCode >= 65 && e.keyCode <= 90) {
            lastVal = jQuery(this).val().substr(getCursortPosition.call(this,this)-1, 1).charCodeAt(0);
            if ((e.shiftKey&&(lastVal>=65&&lastVal<=90))||(lastVal>=65&&lastVal<=90)) {
                if(e.shiftKey ){
                    isCapital = 0;
                }else{
                    isCapital = 1;
                }
                tipsCapsLock3.call(this);
            }else{
                if(lastVal>90&&!(e.shiftKey)){
                    isCapital = 0;
                }else {
                    isCapital = 1;
				}
                tipsCapsLock4.call(this);
            }
        }else{
            changeCapsLock.call(this, e);
        }
    });
    function changeCapsLock(e){
        e.stopPropagation();
        if (e.keyCode != 20||(document.getElementById("userPassword").value.length==0)){
            return;
        }else{
            switch(isCapital){
                case -1:
                    isCapital=1;
                    tipsCapsLock.call(this,this);
                    if (this !== window) tipsCapsLock.call(this);
                    break;
                case 0:
                    isCapital = 1;
                    tipsCapsLock.call(this,this);
                    if (this !== window) tipsCapsLock.call(this);
                    break;
                case 1:
                    isCapital = 0;
                    tipsCapsLock2.call(this,this);
                    if (this !== window) tipsCapsLock2.call(this);
                    break;
            }
        }
    }
    function tipsCapsLock(){
        document.getElementById("text2").innerText="";
        document.getElementById("text1").innerText="大写锁定开启";
    }
    function tipsCapsLock2(){
        document.getElementById("text1").innerText="";
        document.getElementById("text2").innerText="小写锁定开启";
    }
    function tipsCapsLock3(){
        document.getElementById("text2").innerText="";
        document.getElementById("text1").innerText="当前输入为大写";
    }
    function tipsCapsLock4(){
        document.getElementById("text1").innerText="";
        document.getElementById("text2").innerText="当前输入为小写";
    }


    function getCursortPosition (ctrl) {
        var CaretPos = 0;
        if (document.selection) {
            ctrl.focus();
            var Sel = document.selection.createRange ();
            Sel.moveStart('character', -ctrl.value.length);
            CaretPos = Sel.text.length;
        }
        else if (ctrl.selectionStart || ctrl.selectionStart == '0')
            CaretPos = ctrl.selectionStart;
        return (CaretPos);
    }
</script>
